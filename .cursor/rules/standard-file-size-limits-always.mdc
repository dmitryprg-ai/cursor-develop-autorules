---
description:
globs:
alwaysApply: true
tags: [architecture, refactoring, modules]
---

# üìè FILE SIZE LIMITS ‚Äî –õ–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤

## Context

- –ü—Ä–∏–º–µ–Ω—è—Ç—å –ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º/–∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤ —Å –∫–æ–¥–æ–º
- –ü—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∏ Code Review
- –¶–µ–ª—å: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ "–º–æ–Ω–æ–ª–∏—Ç–Ω—ã—Ö" —Ñ–∞–π–ª–æ–≤, —Å–Ω–∏–∑–∏—Ç—å —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

<critical>
  –§–∞–π–ª > 300 —Å—Ç—Ä–æ–∫ = —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–ª–∞–Ω —Ä–∞–∑–±–∏–µ–Ω–∏—è –ü–ï–†–ï–î –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–¥–∞
</critical>

---

## Requirements

### –õ–∏–º–∏—Ç—ã —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤

| –¢–∏–ø —Ñ–∞–π–ª–∞ | Soft limit | Hard limit | –î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ |
|-----------|------------|------------|-------------------------|
| Routes/Controllers | 200 —Å—Ç—Ä–æ–∫ | 400 —Å—Ç—Ä–æ–∫ | Split by domain |
| Services | 250 —Å—Ç—Ä–æ–∫ | 500 —Å—Ç—Ä–æ–∫ | Extract sub-services |
| Repositories | 250 —Å—Ç—Ä–æ–∫ | 500 —Å—Ç—Ä–æ–∫ | Split by entity |
| API client (frontend) | 200 —Å—Ç—Ä–æ–∫ | 400 —Å—Ç—Ä–æ–∫ | Split by feature |
| React components | 200 —Å—Ç—Ä–æ–∫ | 400 —Å—Ç—Ä–æ–∫ | Extract sub-components |
| Types/Interfaces | 150 —Å—Ç—Ä–æ–∫ | 300 —Å—Ç—Ä–æ–∫ | Split by domain |

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑–±–∏–µ–Ω–∏—è

<required>
1. **Single Responsibility** ‚Äî –æ–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
2. **Domain-based splitting** ‚Äî —Ä–∞–∑–±–∏–≤–∞—Ç—å –ø–æ –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω–∞–º, –ù–ï –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º —Å–ª–æ—è–º
3. **Barrel exports** ‚Äî —Å–æ–∑–¥–∞–≤–∞—Ç—å `index.ts` –¥–ª—è re-export –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
4. **Max 10 exports** ‚Äî —Ñ–∞–π–ª —Å >10 exports = –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ —Ä–∞–∑–±–∏–µ–Ω–∏–µ
5. **Dependency direction** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–¥—É—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫ –æ–±—â–µ–º—É
</required>

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–±–∏–µ–Ω–∏—è

**Backend (Express/Node.js):**
```
src/modules/<domain>/
  ‚îú‚îÄ‚îÄ <domain>.routes.ts        # –¢–æ–ª—å–∫–æ route definitions (< 200 —Å—Ç—Ä–æ–∫)
  ‚îú‚îÄ‚îÄ <domain>.controller.ts    # Request handling logic
  ‚îú‚îÄ‚îÄ <domain>.service.ts       # Business logic
  ‚îú‚îÄ‚îÄ <domain>.repository.ts    # Data access
  ‚îú‚îÄ‚îÄ <domain>.types.ts         # Types/interfaces
  ‚îî‚îÄ‚îÄ index.ts                  # Barrel export
```

**Frontend (React/Next.js):**
```
lib/api/
  ‚îú‚îÄ‚îÄ <feature>.api.ts          # API calls for one feature (< 200 —Å—Ç—Ä–æ–∫)
  ‚îú‚îÄ‚îÄ types/
  ‚îÇ   ‚îî‚îÄ‚îÄ <feature>.types.ts    # Types for feature
  ‚îî‚îÄ‚îÄ index.ts                  # Barrel export

features/<feature>/
  ‚îú‚îÄ‚îÄ components/               # Feature-specific components
  ‚îú‚îÄ‚îÄ hooks/                    # Feature-specific hooks
  ‚îú‚îÄ‚îÄ <feature>.types.ts        # Feature types
  ‚îî‚îÄ‚îÄ index.ts                  # Barrel export
```

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–±–∏–µ–Ω–∏—è

<required>
1. **Identify domains** ‚Äî –≤—ã–ø–∏—Å–∞—Ç—å –≤—Å–µ –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω—ã –≤ —Ñ–∞–π–ª–µ
2. **Create directories** ‚Äî —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞
3. **Move incrementally** ‚Äî –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –∫–æ–¥ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —à–∞–≥–∞–º–∏ (1 –¥–æ–º–µ–Ω –∑–∞ —Ä–∞–∑)
4. **Update imports** ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã —á–µ—Ä–µ–∑ barrel files
5. **Test after each step** ‚Äî –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
6. **Delete old code** ‚Äî —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –¢–û–õ–¨–ö–û –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤–æ–≥–æ
</required>

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–∏

| –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|------|-------|
| `routes.ts` (–≤—Å—ë) | `<domain>.routes.ts` (–ø–æ –¥–æ–º–µ–Ω–∞–º) |
| `api.ts` (–≤—Å—ë) | `<feature>.api.ts` (–ø–æ —Ñ–∏—á–∞–º) |
| `service.ts` (–±–æ–ª—å—à–æ–π) | `<sub-domain>.service.ts` |

---

## Examples

<example>
GOOD: –†–∞–∑–±–∏–µ–Ω–∏–µ routes –ø–æ –¥–æ–º–µ–Ω–∞–º
```
src/modules/crm/
  ‚îú‚îÄ‚îÄ deals/
  ‚îÇ   ‚îú‚îÄ‚îÄ deals.routes.ts       # 150 —Å—Ç—Ä–æ–∫ ‚Äî —Ç–æ–ª—å–∫–æ deals endpoints
  ‚îÇ   ‚îú‚îÄ‚îÄ deals.service.ts
  ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
  ‚îú‚îÄ‚îÄ customers/
  ‚îÇ   ‚îú‚îÄ‚îÄ customers.routes.ts   # 120 —Å—Ç—Ä–æ–∫ ‚Äî —Ç–æ–ª—å–∫–æ customers endpoints
  ‚îÇ   ‚îú‚îÄ‚îÄ customers.service.ts
  ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
  ‚îî‚îÄ‚îÄ index.ts                  # re-exports –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
```
</example>

<example>
GOOD: –†–∞–∑–±–∏–µ–Ω–∏–µ api.ts –ø–æ —Ñ–∏—á–∞–º
```
lib/api/
  ‚îú‚îÄ‚îÄ deals.api.ts              # 180 —Å—Ç—Ä–æ–∫ ‚Äî deals API
  ‚îú‚îÄ‚îÄ customers.api.ts          # 90 —Å—Ç—Ä–æ–∫ ‚Äî customers API
  ‚îú‚îÄ‚îÄ analytics.api.ts          # 150 —Å—Ç—Ä–æ–∫ ‚Äî analytics API
  ‚îú‚îÄ‚îÄ types/
  ‚îÇ   ‚îú‚îÄ‚îÄ deals.types.ts
  ‚îÇ   ‚îî‚îÄ‚îÄ customers.types.ts
  ‚îî‚îÄ‚îÄ index.ts                  # export * from './deals.api'; ...
```
</example>

<example type="invalid">
BAD: –û–¥–∏–Ω —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º
```
routes.ts                       # 1800 —Å—Ç—Ä–æ–∫ ‚Äî –í–°–ï endpoints –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
api.ts                          # 1200 —Å—Ç—Ä–æ–∫ ‚Äî –í–°–ï API calls –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
```
–ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ —Ç–µ—Ä—è–µ—Ç—Å—è –í–°–Ø —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å.
</example>

<example type="invalid">
BAD: –†–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º —Å–ª–æ—è–º (–∞ –Ω–µ –ø–æ –¥–æ–º–µ–Ω–∞–º)
```
routes/
  ‚îú‚îÄ‚îÄ get-routes.ts             # –≤—Å–µ GET –∑–∞–ø—Ä–æ—Å—ã
  ‚îú‚îÄ‚îÄ post-routes.ts            # –≤—Å–µ POST –∑–∞–ø—Ä–æ—Å—ã
  ‚îî‚îÄ‚îÄ put-routes.ts             # –≤—Å–µ PUT –∑–∞–ø—Ä–æ—Å—ã
```
–ü—Ä–æ–±–ª–µ–º–∞: –°–≤—è–∑–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–∞ –ø–æ —Ñ–∞–π–ª–∞–º, —Å–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.
</example>

---

## Critical Points

<critical>
### –ü–ï–†–ï–î –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–¥–∞ –≤ —Ñ–∞–π–ª > 300 —Å—Ç—Ä–æ–∫:

1. **STOP** ‚Äî –Ω–µ –¥–æ–±–∞–≤–ª—è–π –∫–æ–¥ —Å—Ä–∞–∑—É
2. **CHECK** ‚Äî –ø–æ—Å—á–∏—Ç–∞–π —Ç–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä: `wc -l <file>`
3. **PLAN** ‚Äî –µ—Å–ª–∏ > 300 —Å—Ç—Ä–æ–∫, —Å–æ—Å—Ç–∞–≤—å –ø–ª–∞–Ω —Ä–∞–∑–±–∏–µ–Ω–∏—è
4. **SPLIT FIRST** ‚Äî —Å–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–±–µ–π, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–π –∫–æ–¥
5. **TEST** ‚Äî –ø—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ —Ä–∞–∑–±–∏–µ–Ω–∏—è

### –ù–ò–ö–û–ì–î–ê:
- ‚ùå –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–¥ –≤ —Ñ–∞–π–ª > 500 —Å—Ç—Ä–æ–∫ –±–µ–∑ —Ä–∞–∑–±–∏–µ–Ω–∏—è
- ‚ùå –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª—ã `_part1.ts`, `_part2.ts`
- ‚ùå –ù–µ —Ä–∞–∑–±–∏–≤–∞—Ç—å –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º —Å–ª–æ—è–º (GET/POST/PUT)

### –í–°–ï–ì–î–ê:
- ‚úÖ –†–∞–∑–±–∏–≤–∞—Ç—å –ø–æ –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω–∞–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å barrel exports (`index.ts`)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ —Ä–∞–∑–±–∏–µ–Ω–∏—è
</critical>

---

**–í–µ—Ä—Å–∏—è:** 1.0
