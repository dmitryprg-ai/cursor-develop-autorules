---
description: Protocol for checking duplicates before creating new files, classes, functions, MCP servers
alwaysApply: false
---
# ğŸ” DUPLICATE CHECK PROTOCOL

## ğŸš¨ MANDATORY: Before Creating ANY New Entity

### 1. Search for Existing Implementations

**BEFORE creating new file/class/function/MCP server:**

```
1. Semantic search: "How is [functionality] implemented?"
2. Grep search: grep for key terms, function names, class names
3. File search: glob_file_search for similar file names
4. Check related directories for existing code
```

### 2. Duplicate Check Report Template

**Write to chat BEFORE creation:**

```markdown
## ğŸ” DUPLICATE CHECK REPORT

### Target: [What I want to create]
- Type: [file/class/function/MCP server]
- Name: [proposed name]
- Purpose: [what it does]

### Search Results:
1. Semantic search: [found/not found] - [details]
2. Grep search: [found/not found] - [details]
3. File search: [found/not found] - [details]

### Similar Implementations Found:
- [ ] [path/to/file] - [similarity description]
- [ ] [path/to/file] - [similarity description]

### Decision:
- [ ] CREATE NEW - No duplicates found (confidence >= 0.7)
- [ ] EXTEND EXISTING - Found similar at [path]
- [ ] ASK USER - Found partial match, need clarification

### Confidence: [X]%
```

### 3. Decision Matrix

| Confidence | Action |
|------------|--------|
| >= 0.9 | Create new without asking |
| 0.7 - 0.9 | Create new, mention in chat |
| 0.5 - 0.7 | Ask user before creating |
| < 0.5 | DO NOT CREATE - find existing |

### 4. Forbidden Actions

âŒ **NEVER:**
- Create files with postfixes: `_fixed`, `_final`, `_FINAL`, `_new`, `_v2`
- Create duplicate MCP servers with similar functionality
- Create new utility functions without checking `lib/`, `utils/`, `shared/`
- Create new components without checking `components/`
- Skip duplicate check "because I'm sure"

### 5. Required Search Paths

**Before creating, always check:**

```
# For TypeScript/React projects:
- src/lib/          # utility functions
- src/utils/        # helpers
- src/shared/       # shared code
- src/components/   # UI components
- src/hooks/        # custom hooks
- src/services/     # API services

# For backend:
- src/modules/      # business logic
- src/routes/       # API routes
- src/middleware/   # middleware
```

### 6. Duplicate Found Protocol

**If duplicates found:**

```markdown
ğŸš¨ ĞĞ‘ĞĞĞ Ğ£Ğ–Ğ•ĞĞ« Ğ”Ğ£Ğ‘Ğ›Ğ˜ĞšĞĞ¢Ğ«:

Existing: [path/to/existing/file]
Proposed: [path/to/new/file]

Options:
1. EXTEND existing file with new functionality
2. REFACTOR existing file to support both cases
3. CREATE new (justify why existing doesn't work)

Recommendation: [Option X] because [reason]
```

### 7. Confidence Calibration

```
Found exact match: -100% (do not create)
Found similar name: -50%
Found similar purpose: -40%
Searched < 3 locations: -30%
No semantic search: -20%
```

**Example:**
```
Base confidence: 90%
Found similar function in utils/: -40%
Final confidence: 50% â†’ ASK USER
```
